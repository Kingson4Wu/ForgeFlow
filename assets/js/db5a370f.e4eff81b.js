"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[7407],{6945:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var l=i(7935),s=i(4848),o=i(8453);const r={slug:"forgeflow-engineering-grade-automation",title:"FORGEFLOW: Engineering-Grade Automation for AI CLIs Inside Tmux",authors:["kingsonwu"],tags:["ai","automation","tmux","cli","forgeflow","development"],description:"Comprehensive guide to ForgeFlow - an engineering-grade automation tool that drives AI CLI tools (Qwen, Gemini, Claude) inside tmux sessions with configurable rules."},t=void 0,c={authorsImageUrls:[void 0]},d=[{value:"This guide covers:",id:"this-guide-covers",level:2},{value:"Who It&#39;s For",id:"who-its-for",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Install And Run",id:"install-and-run",level:2},{value:"Python API",id:"python-api",level:2},{value:"Rules: Project-Level Customization",id:"rules-project-level-customization",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"ANSI Utilities For Smarter Detection",id:"ansi-utilities-for-smarter-detection",level:2},{value:"Simple Flow Diagram",id:"simple-flow-diagram",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Repository And License",id:"repository-and-license",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:'ForgeFlow automates interactive AI CLIs (e.g., Qwen, Gemini, Claude) inside a tmux session using a clean "adapter + rules" architecture. It detects prompts and processing states, sends the right commands, and keeps going until tasks converge \u2014 with logs, extensibility, and sensible recovery behavior.'}),"\n",(0,s.jsx)(n.h2,{id:"this-guide-covers",children:"This guide covers:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"How to install and use ForgeFlow (focus)"}),"\n",(0,s.jsx)(n.li,{children:"Architecture overview, key interfaces, and ANSI support"}),"\n",(0,s.jsx)(n.li,{children:"Extending with custom rules and adapters"}),"\n",(0,s.jsx)(n.li,{children:"A simple flow diagram in Markdown"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"who-its-for",children:"Who It's For"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Developers who live in the terminal and use AI CLIs"}),"\n",(0,s.jsx)(n.li,{children:"Teams that want a repeatable driver for long-running, iterative tasks"}),"\n",(0,s.jsx)(n.li,{children:"Anyone who needs logging and simple extensibility without reinventing the loop"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"requirements",children:"Requirements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"macOS/Linux"}),"\n",(0,s.jsx)(n.li,{children:"Python 3.9+"}),"\n",(0,s.jsx)(n.li,{children:"tmux installed and on PATH"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"install-and-run",children:"Install And Run"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Dev install (pinned tooling):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"pip install -e .[dev] -c constraints-dev.txt"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Runtime install:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"pip install -e ."})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Makefile helpers:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"make dev-install"})," \u2014 install dev deps with constraints"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"make lint"})," / ",(0,s.jsx)(n.code,{children:"make fmt"})," / ",(0,s.jsx)(n.code,{children:"make test"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"make setup-hooks"})," \u2014 optional Git hooks"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Typical run:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'forgeflow \\\n--session qwen_session \\\n--workdir "/abs/path/to/your/project" \\\n--ai-cmd "qwen --proxy http://localhost:7890 --yolo" \\\n--cli-type qwen \\\n--poll 10 \\\n--timeout 2000 \\\n--log-level INFO \\\n--log-file forgeflow.log\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Switch adapters:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--cli-type qwen"})," or ",(0,s.jsx)(n.code,{children:"--cli-type gemini"})," (claude_code is a placeholder)"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Use project-specific rules:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"{project}_rules.py"})," or ",(0,s.jsx)(n.code,{children:"{project}.py"})," in your project root or in examples/"]}),"\n",(0,s.jsxs)(n.li,{children:["Run with ",(0,s.jsx)(n.code,{children:"--project myproject"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'forgeflow \\\n--session qwen_session \\\n--workdir "/abs/path/to/your/project" \\\n--ai-cmd "qwen --proxy http://localhost:7890 --yolo" \\\n--project myproject \\\n--cli-type qwen\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Logging:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--log-file forgeflow.log"})," writes file logs"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--no-console"})," disables console logging"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"--log-level"})," supports DEBUG/INFO/WARNING/ERROR"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"python-api",children:"Python API"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from forgeflow.core.automation import Config, run_automation\n\ncfg = Config(\n    session="qwen_session",\n    workdir="/abs/path/to/your/project",\n    ai_cmd="qwen --proxy http://localhost:7890 --yolo",\n    cli_type="qwen",\n    poll_interval=10,\n    input_prompt_timeout=2000,\n    log_file="forgeflow.log",\n    log_to_console=True,\n    project="myproject",   # optional\n    log_level="INFO",\n)\nrun_automation(cfg)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"rules-project-level-customization",children:"Rules: Project-Level Customization"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["File naming:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"{project}_rules.py"})," or ",(0,s.jsx)(n.code,{children:"{project}.py"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Function name (recommended):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"build_rules()"})," -> ",(0,s.jsx)(n.code,{children:"list[Rule]"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Minimal example:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'# examples/myproject_rules.py\n\nfrom forgeflow.core.rules import Rule\n\ndef build_rules() -> list[Rule]:\n    def done(output: str) -> bool:\n        return "All tasks have been completed." in output\n\n    return [\n        Rule(check=done, command=None),  # stop\n        Rule(check=lambda out: "API Error" in out, command="continue"),\n        Rule(check=lambda out: True, command="continue"),\n    ]\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Rule behavior:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Rules are evaluated in order, the first matching rule returns its command."}),"\n",(0,s.jsx)(n.li,{children:"If command is None, automation stops."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Core loop (",(0,s.jsx)(n.code,{children:"forgeflow/core/automation.py"}),")","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Creates/attaches tmux session"}),"\n",(0,s.jsxs)(n.li,{children:["Determines adapter by ",(0,s.jsx)(n.code,{children:"--cli-type"})]}),"\n",(0,s.jsx)(n.li,{children:'Captures tmux output, checks "prompt vs. processing", evaluates rules'}),"\n",(0,s.jsx)(n.li,{children:"Timeout recovery: ESC \u2192 progressive Backspace until prompt \u2192 send continue"}),"\n",(0,s.jsx)(n.li,{children:"Logging level configurable; file and console outputs supported"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["tmux I/O (",(0,s.jsx)(n.code,{children:"forgeflow/core/tmux_ctl.py"}),")","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Encapsulates tmux operations: session creation, send keys, capture pane"}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"capture_output(include_ansi=False)"})," supports capturing raw ANSI when needed"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Adapters (",(0,s.jsx)(n.code,{children:"forgeflow/core/cli_adapters/*"}),")","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Interface ",(0,s.jsx)(n.code,{children:"CLIAdapter"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"is_input_prompt(output)"})," -> ",(0,s.jsx)(n.code,{children:"bool"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"is_input_prompt_with_text(output)"})," -> ",(0,s.jsx)(n.code,{children:"bool"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"is_task_processing(output)"})," -> ",(0,s.jsx)(n.code,{children:"bool"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"is_ai_cli_exist(output)"})," -> ",(0,s.jsx)(n.code,{children:"bool"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"wants_ansi()"})," -> ",(0,s.jsx)(n.code,{children:"bool"})," \u2014 ask automation to capture pane with ANSI codes"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Implementations: ",(0,s.jsx)(n.code,{children:"qwen.py"}),", ",(0,s.jsx)(n.code,{children:"gemini.py"})," (claude_code placeholder present)"]}),"\n",(0,s.jsxs)(n.li,{children:["Adapter resolution via ",(0,s.jsx)(n.code,{children:"get_cli_adapter(cli_type)"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Rules (",(0,s.jsx)(n.code,{children:"forgeflow/core/rules.py"}),")","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"Rule(check: Callable[[str], bool], command: str | None)"})}),"\n",(0,s.jsxs)(n.li,{children:["Default rules and ",(0,s.jsx)(n.code,{children:"next_command(output, rules)"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Rule loader (",(0,s.jsx)(n.code,{children:"forgeflow/core/rule_loader.py"}),")","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Dynamically loads ",(0,s.jsx)(n.code,{children:"{project}_rules.py"})," or ",(0,s.jsx)(n.code,{children:"{project}.py"})," from workdir or examples/"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"ansi-utilities-for-smarter-detection",children:"ANSI Utilities For Smarter Detection"}),"\n",(0,s.jsx)(n.p,{children:"Some CLIs render distinct prompt colors or attributes. You can opt-in to capture ANSI and parse it in your adapter:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Adapter opt-in:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"def wants_ansi(self) -> bool:\n    return True\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Utilities (",(0,s.jsx)(n.code,{children:"forgeflow/core/ansi.py"}),"):","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"strip_ansi(text)"})," -> ",(0,s.jsx)(n.code,{children:"str"})," \u2014 removes all ANSI escape sequences"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"parse_ansi_segments(text)"})," -> ",(0,s.jsx)(n.code,{children:"list[Segment]"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Splits text into styled segments (tracks SGR attributes)"}),"\n",(0,s.jsx)(n.li,{children:"Supports bold, dim, italic, underline, blink, inverse, strike"}),"\n",(0,s.jsx)(n.li,{children:"Supports FG/BG basic (30\u201337/90\u201397/40\u201347/100\u2013107), 256-color, truecolor"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"split_segments_lines(segments)"})," -> ",(0,s.jsx)(n.code,{children:"list[list[Segment]]"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Split by newline while preserving styles"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Example usage in an adapter:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from forgeflow.core.ansi import parse_ansi_segments\n\nclass MyAdapter(CLIAdapter):\n    def wants_ansi(self) -> bool:\n        return True\n\n    def is_input_prompt(self, output: str) -> bool:\n        # Example heuristic: find a red prompt marker at end of screen\n        segments = parse_ansi_segments(output)\n        text = ''.join(seg.text for seg in segments)\n        return text.rstrip().endswith('>')  # combine with color checks if needed\n"})}),"\n",(0,s.jsx)(n.p,{children:"This keeps default behavior unchanged while enabling color-aware rules when helpful."}),"\n",(0,s.jsx)(n.h2,{id:"simple-flow-diagram",children:"Simple Flow Diagram"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:'flowchart TD\n    A[Start forgeflow] --\x3e B[Create/attach tmux session]\n    B --\x3e C[Ensure AI CLI running]\n    C --\x3e D{Capture output<br/>(ANSI optional)}\n    D --\x3e |prompt & idle| E[Evaluate rules -> command]\n    E --\x3e F[Send text + Enter]\n    F --\x3e G[Sleep 2s]\n    G --\x3e D\n    D --\x3e |prompt has text| H[Send Enter]\n    H --\x3e G\n    D --\x3e |processing| I[Wait poll interval]\n    I --\x3e D\n    D --\x3e |timeout| J[ESC + progressive backspace]\n    J --\x3e K[Send "continue"]\n    K --\x3e D\n    E --\x3e |None| L[Stop]\n'})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:['"tmux is required but not found"',"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Install tmux and ensure ",(0,s.jsx)(n.code,{children:"tmux -V"})," succeeds"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["CLI not detected as running","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Check ",(0,s.jsx)(n.code,{children:"--ai-cmd"})," and allow a few seconds post-launch"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["No project rules","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Defaults are used; add custom rules for better convergence"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"repository-and-license",children:"Repository And License"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Repo: ",(0,s.jsx)(n.a,{href:"https://github.com/kingson4wu/ForgeFlow",children:"https://github.com/kingson4wu/ForgeFlow"})]}),"\n",(0,s.jsx)(n.li,{children:"License: MIT"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},7935:e=>{e.exports=JSON.parse('{"permalink":"/ForgeFlow/blog/forgeflow-engineering-grade-automation","editUrl":"https://github.com/kingson4wu/ForgeFlow/edit/main/documentation/blog/2025-09-16-forgeflow-engineering-grade-automation.md","source":"@site/blog/2025-09-16-forgeflow-engineering-grade-automation.md","title":"FORGEFLOW: Engineering-Grade Automation for AI CLIs Inside Tmux","description":"Comprehensive guide to ForgeFlow - an engineering-grade automation tool that drives AI CLI tools (Qwen, Gemini, Claude) inside tmux sessions with configurable rules.","date":"2025-09-16T00:00:00.000Z","tags":[{"inline":false,"label":"AI","permalink":"/ForgeFlow/blog/tags/ai","description":"Posts about AI automation and tools"},{"inline":false,"label":"Automation","permalink":"/ForgeFlow/blog/tags/automation","description":"Posts about automation workflows and tools"},{"inline":false,"label":"Tmux","permalink":"/ForgeFlow/blog/tags/tmux","description":"Posts about tmux and terminal automation"},{"inline":false,"label":"CLI","permalink":"/ForgeFlow/blog/tags/cli","description":"Posts about command-line interface tools"},{"inline":false,"label":"ForgeFlow","permalink":"/ForgeFlow/blog/tags/forgeflow","description":"Posts specifically about the ForgeFlow tool"},{"inline":false,"label":"Development","permalink":"/ForgeFlow/blog/tags/development","description":"Posts about development practices and tools"}],"readingTime":4.13,"hasTruncateMarker":true,"authors":[{"name":"Kingson Wu","title":"Creator of ForgeFlow","url":"https://github.com/kingson4wu","page":null,"socials":{"github":"https://github.com/kingson4wu","devto":"https://dev.to/kingson4ng"},"imageURL":"https://github.com/kingson4wu.png","key":"kingsonwu"}],"frontMatter":{"slug":"forgeflow-engineering-grade-automation","title":"FORGEFLOW: Engineering-Grade Automation for AI CLIs Inside Tmux","authors":["kingsonwu"],"tags":["ai","automation","tmux","cli","forgeflow","development"],"description":"Comprehensive guide to ForgeFlow - an engineering-grade automation tool that drives AI CLI tools (Qwen, Gemini, Claude) inside tmux sessions with configurable rules."},"unlisted":false,"nextItem":{"title":"Tmux Inner Network Tunneling: Simple Remote Development","permalink":"/ForgeFlow/blog/tmux-inner-network-tunneling-for-remote-development"}}')},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>t});var l=i(6540);const s={},o=l.createContext(s);function r(e){const n=l.useContext(o);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(o.Provider,{value:n},e.children)}}}]);